<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Calculate the Sizing Requirements for RPM and Containerized Installation :: Advanced Deployment of AAP 2.5</title>
    <link rel="prev" href="section3.html">
    <link rel="next" href="section5.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Deployment of AAP 2.5</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/advanced-deployment-aap25/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="advanced-deployment-aap25" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Deployment of AAP 2.5</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Advanced Deployment of Ansible Automation Platform 2.5</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Automation Mesh</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Automation Mesh Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Automation Mesh Hands-on Lab</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section4.html">Calculate the Sizing Requirements for RPM and Containerized Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section5.html">Example on Calculating the Size</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section6.html">Performance Consideration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section7.html">Troubleshooting Ansible Automation Platform Installation Issue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section8.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Deployment of AAP 2.5</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Deployment of AAP 2.5</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Deployment of AAP 2.5</a></li>
    <li><a href="index.html">Advanced Deployment of Ansible Automation Platform 2.5</a></li>
    <li><a href="section4.html">Calculate the Sizing Requirements for RPM and Containerized Installation</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Calculate the Sizing Requirements for RPM and Containerized Installation</h1>
<div class="paragraph">
<p>Having the right amount of resources for the Ansible Automation Platform helps to make the platform reliable and reduce cost. Sizing requirements depend on multiple factors, including the type of automation we are planning to run. High level points that should be considered during capacity planning are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Characterizing the workloads.</p>
</li>
<li>
<p>Reviewing the capabilities of different node types.</p>
</li>
<li>
<p>Planning the deployment based on the requirements of the workload.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below are the isolated factors that play a major role in calculating sizing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of the Managed hosts controlled by the AAP.</p>
</li>
<li>
<p>Jobs or Tasks running per hour per host.</p>
</li>
<li>
<p>Maximum number of concurrent jobs that you want to support.</p>
</li>
<li>
<p>Maximum number of forks set on jobs. Forks determine the number of hosts that a job acts on concurrently.</p>
</li>
<li>
<p>Maximum API requests per second.</p>
</li>
<li>
<p>Node size that you prefer to deploy (CPU/Memory/Disk).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Unified UI</strong></p>
</div>
<div class="paragraph">
<p>Unified UI provides the authentication and load-balancing of requests using the GRPC service. Increasing the CPU and memory will help to reduce bottlenecks when resources are under pressure. You may be having issues with Unified UI capacity if you see 502 gateway errors during access attempts.</p>
</div>
<div class="paragraph">
<p><strong>Automation Execution/Controller</strong></p>
</div>
<div class="paragraph">
<p>There are 4 types of nodes in the RPM-based Ansible Automation platform:
- Control Plane: Control node and Hybrid node.
- Execution Plane: Execution node and Hop node.</p>
</div>
<div class="paragraph">
<p>Control and hybrid nodes play a key role in managing jobs. These nodes are the "managers" that start jobs and handle their results, feeding the data into a database. Every job needs one Control node to manage it.</p>
</div>
<div class="paragraph">
<p>Key Concept for control capacity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each job needs 1 unit of control capacity.</p>
</li>
<li>
<p>A node with 100 capacity units can control up to 100 jobs at once.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Control nodes can be scaled vertically by adding more CPU and memory (i.e., using a larger virtual machine). This increase Control Plane&#8217;s ability to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>manage more jobs simultaneously.</p>
</li>
<li>
<p>process job events faster (by processing more events at the same time).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note: Vertically scaling a Control node does not automatically increase the number of workers that handle web requests. To achieve that, instead of making one Control node larger (vertical scaling), add more Control nodes (horizontal scaling). This spreads the workload and web traffic across multiple nodes using a load balancer. It also adds redundancy in case of node failure. Horizontal scaling is often preferred for better reliability and performance.</p>
</div>
<div class="paragraph">
<p>Recommended practices for vertical scaling are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Scale CPU and memory together, ideally in a 1 CPU to 4 GB RAM ratio.</p>
</li>
<li>
<p>Add CPU together with memory even if CPU was not a bottleneck. During high memory utilization, the queue fills up with unprocessed events. Higher CPU capacity helps to process these events faster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Execution nodes</strong></p>
</div>
<div class="paragraph">
<p>Execution and Hybrid nodes provide execution capacity. The capacity consumed by a job running against one host is called fork. The amount of forks consumed by a running job is equal to either the number of forks set in the job template settings or equals the number of hosts in the inventory the job is running against, whichever value is lower.</p>
</div>
<div class="paragraph">
<p><code>Vertically scaling</code> an Execution node by deploying a larger virtual machine with more resources provides more forks for job execution. This increases the number of concurrent jobs that an instance can run.</p>
</div>
<div class="paragraph">
<p>You can configure an instance group that can only be used for running jobs against a certain Inventory. In this scenario, by <code>horizontally scaling</code> the Execution node, you can ensure that lower-priority jobs do not block higher-priority jobs.</p>
</div>
<div class="paragraph">
<p>Hop nodes use minimal resources, so vertical scaling doesn&#8217;t increase capacity. Instead, monitor bandwidth especially for Hop nodes that connect large amounts of Execution nodes. Consider a network upgrade if bandwidth is close to the capacity.</p>
</div>
<div class="paragraph">
<p>Hop nodes on <code>horizontal scaling</code> can increase redundancy and guarantee that traffic continues to flow even in the event of a node failure.</p>
</div>
<div class="paragraph">
<p>In addition to all the above let&#8217;s keep in mind that the amount of available forks is calculated based on available memory and CPU.</p>
</div>
<div class="paragraph">
<p><strong>Memory Relative Capacity</strong></p>
</div>
<div class="paragraph">
<p><code>mem_capacity</code> setting is the maximum amount of memory needed by one fork. Default value is 100 MB. Knowing the value allows calculating the amount of forks available on a specific host. 2 GB of memory is reserved for the AAP services.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">For example, 16 GB of available node memory means (16384 - 2048)/100 ~ 140 forks</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CPU Relative Capacity</strong></p>
</div>
<div class="paragraph">
<p>Ansible workloads are often processor-bound. In these cases sometimes reducing the simultaneous workload allows more tasks to run faster and reduces the average time-to-completion of those jobs.</p>
</div>
<div class="paragraph">
<p>Just as the <code>mem_capacity</code> defines the amount of memory required per fork, the <code>cpu_capacity</code> defines the amount of processing resources required per fork. The baseline value for this is 1 CPU = 4 forks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">4 cpu * 4 forks per cpu = 16 forks</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determining the amount of forks available for a specific node is a choice on a scale between the calculated CPU-bound capacity and the memory-bound capacity.</p>
</div>
<div class="paragraph">
<p><code>capacity_adjustment`</code> value determines how close this choice is to the highest number. The value is between 0 and 1. If set to 1, then the highest number is used. For the calculation examples above adjustment value of 1 means 140 forks. The value of 0 means 16 forks. In case of 0.5 the calculation is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Capacity = [140 forks memory * 0.50] + [16 forks of CPU * 0.50]
	  = 70 + 8 = 78 forks.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Everything discussed so far is applicable to both RPM and Containerized deployments. The only difference between the two is that Containerized deployment doesn&#8217;t have Control nodes as explained in the previous chapter.</p>
</div>
<div class="paragraph">
<p>When planning capacity it&#8217;s important to know the expected workload types and additional components involved. Let&#8217;s consider the examples in the following two sections.</p>
</div>
<div class="paragraph">
<p><strong>Event-driven Ansible Controller / Automation Decision</strong></p>
</div>
<div class="paragraph">
<p>Event-driven Ansible workloads include the number of rulebook activations and events being received. The following factors should be considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of simultaneous rulebook activations</p>
</li>
<li>
<p>Number of events received by Event-Driven Ansible controller</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Event-driven Ansible controller allows 12 rulebook activations per node and 24 activations in total can run simultaneously. Even if there are more resources available, this limit will not be exceeded unless overwritten by <code>MAX_RUNNING_ACTIVATIONS</code> setting in /etc/ansible-automation-platform/eda/settings.yaml file. Run <code>automation-eda-controller-service restart</code> after changing the value.</p>
</div>
<div class="paragraph">
<p>Memory usage is based on the number of events that the Event-driven Ansible controller has to process. Each rulebook activation container has a 200MB memory limit. For example, with 4 CPUs and 16GB of RAM, one rulebook activation container with an assigned <code>200MB</code> memory limit can not handle more than 150,000 events per minute. If the number of parallel running rulebook activations is higher, then the maximum number of events each rulebook activation can process is reduced. If there are too many incoming events at a very high rate, the container can run out of memory trying to process the events. This will kill the container, which causes rulebook activation to fail with a status code of 137.</p>
</div>
<div class="paragraph">
<p>To increase this limit to 400MB, as an example, open /etc/ansible-automation-platform/eda/settings.yaml, set <code>PODMAN_MEM_LIMIT = 400m</code> and restart the <code>automation-eda-controller-service restart</code> on the EDA server.</p>
</div>
<div class="paragraph">
<p><strong>Automation Content or Private Automation Hub (PAH)</strong></p>
</div>
<div class="paragraph">
<p>PAH provides Execution Environments and collections therefore there is not much need for memory or CPU resources by this component. Meeting the minimum and storage requirements should be enough:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of Execution Environments you have.</p>
</li>
<li>
<p>Size of each execution environment.</p>
</li>
<li>
<p>Number of versions of each execution environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, make sure there is enough Database space for the PAH system. Most of the time the default amount should be enough however the above factors need to be taken into consideration, especially if the requirement is to calculate the amount of space more precisely.</p>
</div>
<nav class="pagination">
  <span class="prev"><a href="section3.html">Automation Mesh Hands-on Lab</a></span>
  <span class="next"><a href="section5.html">Example on Calculating the Size</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
